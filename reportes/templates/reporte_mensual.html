{% extends 'base.html' %}
{% load static %}



{%block title %} Reporte Mensual LAB {% endblock %}

{% block principal %}
{% block informacion% %}
<div class="container-fluid p-4">
    <div class="row">
        <div class="col-xl-12 mt-1">
            <div class="card card-default">
                <div class="card-header bg-gray-dark">
                    <h3 class="card-title">
                        <i class="fas fa-bullhorn"></i>
                        Información
                    </h3>
                </div>
                <!-- /.card-header -->
                <div class="card-body">

                    <div class="callout callout-info">

                        <h5>Reporte Mensual para el Laboratorio de control de calidad</h5>
                        <p>En esta sección se recaba toda la informacion obtenida de blalblabla</p>
                        
                    </div>

                </div>
                <!-- /.card-body -->
            </div>
            <!-- /.card -->
        </div>
        <!-- /.col -->


    </div>
</div>
{% endblock %}

{% block datatable %}
<div class="container-fluid p-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-center align-items-center bg-gray-dark">
                    <h3 class="card-title">Reporte mensual LAB</h3>
                </div>
                <div class="card-body bg-light">
                     <!-- Formulario de Búsqueda -->
                    <form method="get" action="{% url 'reportes:reporte_mensual' %}">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="fecha_inicio">Fecha Inicio:</label>
                                    <input type="date" id="fecha_inicio" name="fecha_inicio" class="form-control" value="{{ fecha_inicio }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="fecha_fin">Fecha Fin:</label>
                                    <input type="date" id="fecha_fin" name="fecha_fin" class="form-control" value="{{ fecha_fin }}">
                                </div>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary">Consultar</button>
                            </div>
                        </div>
                    </form> 
                    <div class="col-xl-12 mt-3 p-3">
                        <div class="table-responsive">
                            <a class="btn btn-primary" href="{% url 'api:reporte_mensual_pdf' %}">Ver reporte en PDF</a>

                            <hr>
                        <!-- Tabla Composición Fisicoquímica -->
                        <table class="table table-bordered table-sm bg-light table-hover mb-4">
                            <thead>
                                <tr>
                                    <th colspan="22" class="bg-dark text-white">COMPOSICIÓN FISIOQUÍMICA</th>

                                </tr>
                                <tr>
                                    <th rowspan="3" class="text-center">Puntos de Evaluación</th>
                                    <th rowspan="3" class="text-center">Número de Muestras</th>
                                    <th colspan="4" class="text-center">Densidad</th>
                                    <th colspan="4" class="text-center">Grasa</th>
                                    <th colspan="4" class="text-center">SNG</th>
                                    <th colspan="4" class="text-center">Proteínas</th>
                                    <th colspan="4" class="text-center">Temperatura</th>
                                </tr>
                                <tr>
                                    <th colspan="4" class="text-center">g/ml</th>
                                    <th colspan="4" class="text-center">%</th>
                                    <th colspan="4" class="text-center">%</th>
                                    <th colspan="4" class="text-center">%</th>
                                    <th colspan="4" class="text-center">°C</th>
                                </tr>
                                <tr>
                                    <th class="text-center">x</th>
                                    <th class="text-center">%FLE</th>
                                    <th class="text-center">vMAX</th>
                                    <th class="text-center">vMIN</th>
                                    <th class="text-center">x</th>
                                    <th class="text-center">%FLE</th>
                                    <th class="text-center">vMAX</th>
                                    <th class="text-center">vMIN</th>
                                    <th class="text-center">x</th>
                                    <th class="text-center">%FLE</th>
                                    <th class="text-center">vMAX</th>
                                    <th class="text-center">vMIN</th>
                                    <th class="text-center">x</th>
                                    <th class="text-center">%FLE</th>
                                    <th class="text-center">vMAX</th>
                                    <th class="text-center">vMIN</th>
                                    <th class="text-center">x</th>
                                    <th class="text-center">%FLE</th>
                                    <th class="text-center">vMAX</th>
                                    <th class="text-center">vMIN</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ volumen }}</td>
                                    <td>{{ numero_muestras }}</td>
                                    <td>{{ densidad_promedio|floatformat:2 }}</td>
                                    <td>{{ densidad_fle }}</td>
                                    <td>{{ densidad_maximo }}</td>
                                    <td>{{ densidad_minimo }}</td>
                                    <td>{{ grasas_promedio|floatformat:2 }}</td>
                                    <td>{{ grasas_fle }}</td>
                                    <td>{{ grasas_maximo }}</td>
                                    <td>{{ grasas_minimo }}</td>
                                    <td>{{ sng_promedio }}</td>
                                    <td>{{ sng_fle }}</td>
                                    <td>{{ sng_maximo }}</td>
                                    <td>{{ sng_minimo }}</td>
                                    <td>{{ proteina_promedio|floatformat:2 }}</td>
                                    <td>{{ proteina_fle }}</td>
                                    <td>{{ proteina_maximo }}</td>
                                    <td>{{ proteina_minimo }}</td>
                                    <td>{{ temperatura_promedio|floatformat:2 }}</td>
                                    <td>{{ temperatura_fle }}</td>
                                    <td>{{ temperatura_maximo }}</td>
                                    <td>{{ temperatura_minimo }}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <hr>

                        <!-- Tabla Datos de Producción -->
                        <table class="table table-bordered table-sm bg-light table-hover mb-4" >
                            <thead>
                                <tr>
                                    <th colspan="2" class="bg-dark text-white">DATOS DE PRODUCCIÓN</th>
                                </tr>
                                <tr>
                                    <th class="text-center">Producción real</th>
                                    <th class="text-center">Producción ventas</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dato in datos %}
                                <tr>
                                    <td class="text-center">{{ dato.aspecto }}</td>
                                    <td class="text-center">{{ dato.volumen}}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="22" class="text-center">No se encontraron datos</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
    
                        <hr>

                        <!-- Tabla Control de Envasado -->
                        <table class="table table-bordered table-sm bg-light table-hover mb-4">
                            <thead>
                                <tr>
                                    <th colspan="6" class="bg-dark text-white">CONTROL DE ENVASADO</th>
                                </tr>
                                <tr>
                                    <th rowspan="3" class="text-center">n</th>
                                    <th colspan="5" class="text-center">Contenido neto</th>
                                </tr>
                                <tr>
                                    <th colspan="5" class="text-center">ml</th>
                                </tr>
                                <tr>
                                    <th class="text-center">X</th>
                                    <th class="text-center">fli</th>
                                    <th class="text-center">CND-2T</th>
                                    <th class="text-center">máximo</th>
                                    <th class="text-center">mínimo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ n }}</td>
                                    <td>{{ contenido_neto_promedio }}</td>
                                    <td>{{ contenido_neto_fli }}</td>
                                    <td>{{ contenido_neto_cnd2t }}</td>
                                    <td>{{ contenido_neto_maximo }}</td>
                                    <td>{{ contenido_neto_minimo }}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <hr>
                        
                        <!-- Tabla Calidad Microbiológica -->
                        <table class="table table-bordered table-sm bg-light table-hover mb-4">
                            <thead>
                                <tr>
                                    <th colspan="8" class="bg-dark text-white">CALIDAD MICROBIOLÓGICA</th>
                                </tr>
                                <tr>
                                    <th rowspan="3" class="text-center">Puntos de evaluación</th>
                                    <th rowspan="3" class="text-center">Número de muestras</th>
                                    <th colspan="3" class="text-center">Organismos coliformes</th>
                                    <th colspan="3" class="text-center">Aerobias</th>
                                </tr>
                                <tr>
                                    <th colspan="3" class="text-center">UFC/ml</th>
                                    <th colspan="3" class="text-center">UFC/ml</th>
                                </tr>
                                <tr>
                                    <th class="text-center">X</th>
                                    <th class="text-center">Fle</th>
                                    <th class="text-center">Máximo</th>
                                    <th class="text-center">X</th>
                                    <th class="text-center">Fle</th>
                                    <th class="text-center">Máximo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ punto_evaluacion }}</td>
                                    <td>{{ numero_muestras }}</td>
                                    <td>{{ coliformes_promedio }}</td>
                                    <td>{{ coliformes_fli }}</td>
                                    <td>{{ coliformes_maximo }}</td>
                                    <td>{{ aerobias_promedio }}</td>
                                    <td>{{ aerobias_fli }}</td>
                                    <td>{{ aerobias_maximo }}</td>
                                </tr>
                            </tbody>
                        </table>
    
                        <hr>

                        <!-- Tabla Observaciones -->
                        <table class="table table-bordered table-sm bg-light table-hover mb-4">
                            <thead>
                                <tr>
                                    <th colspan="6" class="bg-dark text-white">OBSERVACIONES</th>
                                </tr>
                                <tr>
                                    <th class="text-center">Peso de envase vacío</th>
                                    <th class="text-center">n</th>
                                    <th class="text-center">x</th>
                                    <th class="text-center">V.MAX</th>
                                    <th class="text-center">V.MIN</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td></td>
                                    <td>{{ peso_envase_vacio_n }}</td>
                                    <td>{{ peso_envase_vacio_x }}</td>
                                    <td>{{ peso_envase_vacio_vmax }}</td>
                                    <td>{{ peso_envase_vacio_vmin }}</td>
                                </tr>
                                <tr>
                                    <td colspan="6">INFO</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <hr>

                        <!-- Tabla Análisis Complementarios -->
                        <table class="table table-bordered table-sm bg-light table-hover mb-4">
                            <thead>
                                <tr>
                                    <th colspan="8" class="bg-dark text-white">ANALISIS COMPLEMENTARIOS</th>
                                </tr>
                                <tr>
                                    <th rowspan="2">Puntos de evaluación</th>
                                    <th colspan="4">PH</th>
                                    <th colspan="3">NEUTRALIZANTES</th>
                                </tr>
                                <tr>
                                    <th>n</th>
                                    <th>x</th>
                                    <th>V.MAX</th>
                                    <th>V.MIN</th>
                                    <th>n</th>
                                    <th>Positivo</th>
                                    <th>Negativo</th>
                                </tr>
                    
                                <tbody>
                                    <tr>
                                        <td>{{ punto_evaluacion }}</td>
                                        <td>{{ ph_n }}</td>
                                        <td>{{ ph_x }}</td>
                                        <td>{{ ph_vmax }}</td>
                                        <td>{{ ph_vmin }}</td>
                                        <td>{{ neutrales_n }}</td>
                                        <td>{{ neutrales_positivo }}</td>
                                        <td>{{ neutrales_negativo }}</td>
                                    </tr>
                                    <tr>
                                        <td colspan="8">INFO</td>
                                    </tr>
                                </tbody>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</div>
</div>
    {% endblock %}
{% endblock %}


{% block javascript %}
{{ block.super }}

<!-- Script para inicializar DataTables -->
<script src="{% static 'js/datatables/datatable_turnos.js' %}"></script>



{% endblock %}
